<!DOCTYPE html>
<html lang='en'>
<head>
<title>blog</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="A humble blog by me, Lucy Wyman">
<meta name="keywords" content="blog, code, lucy, wyman">
<meta name="keywords" content="(<Tag u'orchestrator'>, [<pelican.contents.Article object at 0x7f4070216d50>])">
<meta name="keywords" content="(<Tag u'conferences'>, [<pelican.contents.Article object at 0x7f4070480650>, <pelican.contents.Article object at 0x7f40703a8810>, <pelican.contents.Article object at 0x7f40703c4ed0>])">
<meta name="keywords" content="(<Tag u'travel'>, [<pelican.contents.Article object at 0x7f4070343750>])">
<meta name="keywords" content="(<Tag u'interviews'>, [<pelican.contents.Article object at 0x7f4070505b10>])">
<meta name="keywords" content="(<Tag u'concerts'>, [<pelican.contents.Article object at 0x7f4070343750>])">
<meta name="keywords" content="(<Tag u'book-review'>, [<pelican.contents.Article object at 0x7f40702b4e90>, <pelican.contents.Article object at 0x7f407053cb90>, <pelican.contents.Article object at 0x7f4070284890>, <pelican.contents.Article object at 0x7f4070284610>, <pelican.contents.Article object at 0x7f4070284e90>, <pelican.contents.Article object at 0x7f4070307190>, <pelican.contents.Article object at 0x7f40702b4690>, <pelican.contents.Article object at 0x7f407024ac50>, <pelican.contents.Article object at 0x7f40703923d0>, <pelican.contents.Article object at 0x7f4070392710>, <pelican.contents.Article object at 0x7f407053ccd0>, <pelican.contents.Article object at 0x7f4070505c90>, <pelican.contents.Article object at 0x7f4070216cd0>, <pelican.contents.Article object at 0x7f4070284a10>])">
<meta name="keywords" content="(<Tag u'application'>, [<pelican.contents.Article object at 0x7f4070216d50>])">
<meta name="keywords" content="(<Tag u'flag'>, [<pelican.contents.Article object at 0x7f4070216d50>])">
<meta name="keywords" content="(<Tag u'books'>, [<pelican.contents.Article object at 0x7f40702b42d0>, <pelican.contents.Article object at 0x7f407040ac90>])">
<meta name="keywords" content="(<Tag u'puppet'>, [<pelican.contents.Article object at 0x7f4070216d50>, <pelican.contents.Article object at 0x7f40703431d0>])">
<meta name="keywords" content="(<Tag u'loves'>, [<pelican.contents.Article object at 0x7f40702b42d0>, <pelican.contents.Article object at 0x7f407040ac90>, <pelican.contents.Article object at 0x7f4070392d50>, <pelican.contents.Article object at 0x7f4070392f50>, <pelican.contents.Article object at 0x7f4070294750>, <pelican.contents.Article object at 0x7f407054ee90>])">
<meta name="keywords" content="(<Tag u'openstack'>, [<pelican.contents.Article object at 0x7f4070216d10>])">
<meta name="keywords" content="(<Tag u'tech'>, [<pelican.contents.Article object at 0x7f4070216d50>, <pelican.contents.Article object at 0x7f40703fdc50>, <pelican.contents.Article object at 0x7f40703431d0>, <pelican.contents.Article object at 0x7f4070343090>, <pelican.contents.Article object at 0x7f4070216d10>, <pelican.contents.Article object at 0x7f4070392d50>, <pelican.contents.Article object at 0x7f40703a8810>, <pelican.contents.Article object at 0x7f4070505b10>, <pelican.contents.Article object at 0x7f4070392f50>, <pelican.contents.Article object at 0x7f4070284a10>, <pelican.contents.Article object at 0x7f40703c4ed0>])">
<meta name="keywords" content="(<Tag u'experiences'>, [<pelican.contents.Article object at 0x7f40703fdc50>, <pelican.contents.Article object at 0x7f4070343090>, <pelican.contents.Article object at 0x7f4070480650>, <pelican.contents.Article object at 0x7f4070343750>, <pelican.contents.Article object at 0x7f40703a8810>, <pelican.contents.Article object at 0x7f4070505b10>, <pelican.contents.Article object at 0x7f4070480ad0>])">
<meta name="keywords" content="(<Tag u'example'>, [<pelican.contents.Article object at 0x7f4070216d50>])">
<meta name="keywords" content="(<Tag u'women'>, [<pelican.contents.Article object at 0x7f40703fdc50>, <pelican.contents.Article object at 0x7f4070284610>, <pelican.contents.Article object at 0x7f4070294750>, <pelican.contents.Article object at 0x7f4070216cd0>])">
<meta name="robots" content="index, follow">
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Blog" />
<meta property="og:url" content="http://blog.lucywyman.me" />
<meta property="og:site_name" content="Blog" />

<script src="/theme/js/jquery-1.11.2.js"></script>
<link rel='stylesheet' href='/theme/css/main.css' type='text/css'>
<link href="/theme/images/favicon.ico" type="image/icon" rel="icon">
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-48093989-5', 'auto');
ga('send', 'pageview');

</script>
</head>	<body>
		<nav>
			<ul>
				<li><h3><a href='http://blog.lucywyman.me'>Lucy Wyman</a></h3></li>
				<li><a href='http://blog.lucywyman.me/about.html'>About</a></li>
				<li>
					<a href='http://blog.lucywyman.me/category/books.html'>
						Books</a>
				</li>
				<li>
					<a href='http://blog.lucywyman.me/category/tech.html'>
						Tech</a>
				</li>
				<li>
					<a href='http://blog.lucywyman.me/category/experiences.html'>
						Experiences</a>
				</li>
				<li>
					<a href='http://blog.lucywyman.me/category/loves.html'>
						Loves</a>
				</li>
			</ul>
		</nav>
		<div class='wrapper'>
			<main>
<div class='article'>
<h2>Puppet Orchestrator --application Example</h2>
<p>10.26.2016</p>
<p>As always, this technical blog post began when I was having a problem
and couldn't find the answer on the internet.  I'm writing tests for
Puppet's <a class="reference external" href="https://docs.puppet.com/pe/latest/app_orchestration_overview.html">application orchestrator</a> which involve setting up an
application remotely then running some variations of <code>puppet job
run</code>.  In particular, I need to specify an environment (<code>-e or
--environment</code>) and an application instance (<code>-a or
--application</code>).</p>
<p>Here's my directory structure:</p>
<pre class="code literal-block">
[root&#64;hostname environments]# tree
.
├── production
│&nbsp;&nbsp; ├── environment.conf
│&nbsp;&nbsp; ├── hieradata
│&nbsp;&nbsp; ├── manifests
│&nbsp;&nbsp; │&nbsp;&nbsp; └── site.pp
│&nbsp;&nbsp; └── modules
└── tmpenv
    ├── manifests
    │&nbsp;&nbsp; └── site.pp
    └── modules
        ├── app_one
        │&nbsp;&nbsp; ├── manifests
        │&nbsp;&nbsp; │&nbsp;&nbsp; ├── db_component.pp
        │&nbsp;&nbsp; │&nbsp;&nbsp; ├── init.pp
        │&nbsp;&nbsp; │&nbsp;&nbsp; └── web_component.pp
        │&nbsp;&nbsp; └── README.md
        ├── README.md
        └── shared_types_and_providers
            └── lib
                └── puppet
                    ├── provider
                    │&nbsp;&nbsp; ├── testhttp
                    │&nbsp;&nbsp; │&nbsp;&nbsp; └── test_file.rb
                    │&nbsp;&nbsp; └── testsql
                    │&nbsp;&nbsp;     └── test_file.rb
                    └── type
                        ├── testhttp.rb
                        └── testsql.rb
</pre>
<p>And the output of running <code>puppet app show -e tmpenv</code> is:</p>
<pre class="code literal-block">
App_one[Health Check Test]
    App_one::Db_component[Health Check Test] =&gt; y21898u9zb3yin5.delivery.puppetlabs.net
        + produces Testsql[Health Check Test]
    App_one::Web_component[Health Check Test] =&gt; hzmjunpoua0mxeo.delivery.puppetlabs.net
        consumes Testsql[Health Check Test]
</pre>
<p>Ok, so, as I see it there are 2 strong candidates for what the
&quot;&lt;APPLICATION&gt;&quot; referred to in the <a class="reference external" href="https://docs.puppet.com/pe/latest/orchestrator_job_run.html">puppet orchestrator
documentation</a> could be: <strong>app_one</strong> or <strong>App_one[Health Check
Test]</strong>. Here's the output for each of those (using puppet job plan so
that I'm not creating new job id's and logs all over the place):</p>
<pre class="code literal-block">
[root&#64;hostname environments]# puppet job plan -e tmpenv -a app_one
Failed to submit plan: puppetlabs.orchestrator/unknown-target: The target was not found in environment tmpenv: app_one

[root&#64;hostname environments]# puppet job plan -e tmpenv -a App_one[Health Check Test]
terminate called after throwing an instance of 'HorseWhisperer::action_validation_error' what():  Validation Error: You supplied too many arguments to the run command. Only 1 is allowed.
  Aborted
</pre>
<p>In desperation, I decide to try a combination of the two <strong>App_one</strong>.</p>
<pre class="code literal-block">
[root&#64;hostname environments]# puppet job plan -e tmpenv -a
App_one
+-------------------+---------+
| Environment       | tmpenv  |
| Target            | App_one |
| Concurrency Limit | None    |
| Nodes             | 2       |
+-------------------+---------+

Application instances: 1
  - App_one[Health Check Test]

Node run order (nodes in level 0 run before their dependent nodes in
level 1, etc.):
0 -----------------------------------------------------------------------
y21898u9zb3yin5.delivery.puppetlabs.net
    App_one[Health Check Test] - App_one::Db_component[Health Check
    Test]

1 -----------------------------------------------------------------------
hzmjunpoua0mxeo.delivery.puppetlabs.net
    App_one[Health Check Test] - App_one::Web_component[Health
    Check Test]

Use `puppet job run --application 'App_one' --environment
tmpenv` to create and run a job like this.
Node catalogs may have changed since this plan was
generated.
</pre>
<p>Success!  I later discovered that <code>puppet job plan -e tmpenv -a
&quot;App_one[Health Check Test]&quot;</code> also worked.  It's still unclear to me
why the name needs be capitalized, but I trust that there are good and
well thought out Reasons which just aren't documented.</p>
<p>So, if you don't know, now you know :)</p>

</div>
			</main>
			<aside>
				<div class='sidebar'>
					<div class='social-media'>
						<a href='https://github.com/lucywyman'>
							<img class='social' src='theme/images/github-icon.png'>
						</a>
						<a href='http://linkedin.com/pub/lucy-wyman/70/553/6a7/'>
							<img class='social' src='theme/images/linkedin.png'>
						</a>
						<a href='https://plus.google.com/107251431728646146032/posts'>
							<img class='social' src='theme/images/google-plus.png'>
						</a>
					</div>
					<!--TODO: search, subscribe, archive-->
                 <p><a href='/feed.rss'>Subscribe via RSS <img class='social' src='theme/images/icon-rss.png'></a></p><hr>
                <h3>Categories</h3>
			<ul>
                <li> 
                    <a href='http://blog.lucywyman.me/category/books.html'>Books</a>
                </li> 
                <li> 
                    <a href='http://blog.lucywyman.me/category/tech.html'>Tech</a>
                </li> 
                <li> 
                    <a href='http://blog.lucywyman.me/category/experiences.html'>Experiences</a> 
                </li> 
                <li> 
                    <a href='http://blog.lucywyman.me/category/loves.html'>Loves</a>
                </li>
			</ul>
            <hr>
            <h3>Tags</h3>
                </div>
			</aside>
		</div>
		<div class='footer'>
			<!-- TODO -->
			<a href='https://github.com/lucywyman'>
				<img class='social' src='theme/images/github-icon.png'>
			</a>
			<a href='http://linkedin.com/pub/lucy-wyman/70/553/6a7/'>
				<img class='social' src='theme/images/linkedin.png'>
			</a>
			<a href='https://plus.google.com/107251431728646146032/posts'>
				<img class='social' src='theme/images/google-plus.png'>
			</a>
		</div>
	</body>
</html>

